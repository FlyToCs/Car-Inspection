@page
@model IndexModel
@{
    Layout = "Layouts/_FrontLayout";
    ViewData["Title"] = "صفحات اصلی";
}

@section VendorStyles {
    <link rel="stylesheet" href="~/vendor/libs/nouislider/nouislider.dist.css" />
    <link rel="stylesheet" href="~/vendor/libs/swiper/swiper.dist.css" />
    <link rel="stylesheet" href="~/vendor/libs/bs-stepper/bs-stepper.dist.css" />
    <link rel="stylesheet" href="~/vendor/libs/bootstrap-select/bootstrap-select.dist.css" />
    <link rel="stylesheet" href="~/vendor/libs/select2/select2.dist.css" />
}
@section PageStyles {
    <link rel="stylesheet" href="~/vendor/css/pages/front-page-landing.dist.css" />
}
@section VendorScripts {
    <script src="~/vendor/libs/nouislider/nouislider.dist.js"></script>
    <script src="~/vendor/libs/swiper/swiper.dist.js"></script>
    <script src="~/vendor/libs/bs-stepper/bs-stepper.dist.js"></script>
    <script src="~/vendor/libs/bootstrap-select/bootstrap-select.dist.js"></script>
    <script src="~/vendor/libs/bootstrap-select/i18n/defaults-fa_IR.dist.js"></script>
    <script src="~/vendor/libs/select2/select2.dist.js"></script>
    <script src="~/vendor/libs/select2/i18n/fa.dist.js"></script>
}




<div data-bs-spy="scroll" class="scrollspy-example">
    <section id="hero-animation">
        <div id="landingHero" class="section-py landing-hero position-relative">
            <div class="container">
                <div class="hero-text-box text-center">
                    <h1 class="text-primary hero-title display-6 fw-bold ">
                        ثبت نوبت معاینه فنی خودرو
                    </h1>
                    <h2 class="hero-sub-title h6 mb-4 mt-2 pb-1 lh-2">
                        با بهترین خدمات و کیفیت
                        <br class="d-none d-lg-block" />
                        همراه با گارانتی ، پشتیبانی و شخصی سازی آسان
                    </h2>
                    <div class="landing-hero-btn d-inline-block position-relative">
                        <span class="hero-btn-item position-absolute d-none d-md-flex text-heading">
                            فرصت استثناییءء
                            <img alt="پیکان انجمن" class="scaleX-n1-rtl" src="~/img/front-pages/icons/Join-community-arrow.png" />
                        </span>
                        <a class="btn btn-primary btn-lg" href="#appointmentForm">ثبت نوبت</a>
                    </div>
                </div>
            </div>
        </div>



        <div class="container py-5" id="appointmentForm">
            <div class="row justify-content-center">
                <div class="col-lg-8">

                    @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            @TempData["Success"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <div class="card shadow-lg">
                        <div class="card-header bg-primary text-white text-center">
                            <h4 class="mb-0">فرم یکپارچه ثبت نوبت معاینه فنی</h4>
                            <p class="mb-0">لطفا مشخصات خود و خودرو را جهت رزرو نوبت وارد نمایید.</p>
                        </div>
                        <div class="card-body">



                            <form method="post" enctype="multipart/form-data">

                                <div asp-validation-summary="ModelOnly" class="alert alert-danger mb-4" role="alert"></div>

                                <h5 class="mt-3 mb-3 border-bottom pb-2 text-primary">اطلاعات صاحب خودرو</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label" for="OwnerFirstName">نام کوچک <span class="text-danger">*</span></label>
                                        <input class="form-control" id="OwnerFirstName" name="Appointment.OwnerFirstName" value="@Model.Appointment?.OwnerFirstName" placeholder="امیر" type="text" />
                                        <span asp-validation-for="Appointment.OwnerFirstName" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" for="OwnerLastName">نام خانوادگی <span class="text-danger">*</span></label>
                                        <input class="form-control" id="OwnerLastName" name="Appointment.OwnerLastName" value="@Model.Appointment?.OwnerLastName" placeholder="مقصودلو" type="text" />
                                        <span asp-validation-for="Appointment.OwnerLastName" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" for="OwnerMobile">شماره موبایل <span class="text-danger">*</span></label>
                                        <input class="form-control" id="OwnerMobile" name="Appointment.OwnerMobile" value="@Model.Appointment?.OwnerMobile" placeholder="09121234567" type="tel" />
                                        <span asp-validation-for="Appointment.OwnerMobile" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" for="OwnerNationalId">کد ملی <span class="text-danger">*</span></label>
                                        <input class="form-control" id="OwnerNationalId" name="Appointment.OwnerNationalId" value="@Model.Appointment?.OwnerNationalId" placeholder="1234567890" type="text" />
                                        <span asp-validation-for="Appointment.OwnerNationalId" class="text-danger"></span>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label" for="OwnerAddress">آدرس کامل</label>
                                        <textarea class="form-control" id="OwnerAddress" name="Appointment.OwnerAddress" placeholder="تهران، خیابان ولیعصر..." rows="2">@Model.Appointment?.OwnerAddress</textarea>
                                        <span asp-validation-for="Appointment.OwnerAddress" class="text-danger"></span>
                                    </div>
                                </div>

                                <h5 class="mt-4 mb-3 border-bottom pb-2 text-primary">اطلاعات نوبت و خودرو</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label" for="AppointmentDate">تاریخ نوبت <span class="text-danger">*</span></label>
                                        @{
                                            string dateValue = Model.Appointment != null ? Model.Appointment.AppointmentDate.ToString("yyyy-MM-dd") : DateOnly.FromDateTime(DateTime.Now).ToString("yyyy-MM-dd");
                                        }
                                        <input class="form-control" id="AppointmentDate" name="Appointment.AppointmentDate" type="date" value="@dateValue" />
                                        <span asp-validation-for="Appointment.AppointmentDate" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label d-block" for="LicensePlateParts">پلاک خودرو <span class="text-danger">*</span></label>

                                        <div class="d-flex border border-dark rounded overflow-hidden shadow-sm" id="PlaqueInputContainer">

                                            <div class="d-flex flex-column justify-content-center align-items-center bg-dark text-white p-1" style="width: 40px; border-left: 1px solid #dee2e6;">
                                                <div style="height: 4px; background-color: green; width: 100%;"></div>
                                                <div style="height: 4px; background-color: white; width: 100%;"></div>
                                                <div style="height: 4px; background-color: red; width: 100%;"></div>
                                                <small style="font-size: 8px;">I.R. IRAN</small>
                                            </div>

                                            <div class="d-flex align-items-center flex-grow-1 bg-white p-1">

                                                <input class="form-control text-center border-0 border-end border-dark p-0 h-100" id="PlaquePart1" type="text" maxlength="2" placeholder="۰۱" style="font-size: 1.5rem; max-width: 50px;" dir="ltr" />

                                                <input class="form-control text-center border-0 border-end border-dark p-0 h-100" id="PlaquePart2" type="text" maxlength="1" placeholder="ب" style="font-size: 1.5rem; max-width: 50px;" />

                                                <input class="form-control text-center border-0 border-end border-dark p-0 h-100" id="PlaquePart3" type="text" maxlength="3" placeholder="۲۳۴" style="font-size: 1.5rem; max-width: 90px;" dir="ltr" />

                                                <div class="text-center fw-bold px-1" style="width: 50px; font-size: 0.9rem;">
                                                    ایران
                                                    <div class="text-dark">
                                                        <input class="form-control text-center border-0 p-0 h-100" id="PlaquePart4" type="text" maxlength="2" placeholder="۵۶" style="font-size: 1.2rem; max-width: 35px; display: inline-block;" dir="ltr" />
                                                    </div>
                                                </div>

                                            </div>

                                            <input type="hidden" id="LicensePlate" name="Appointment.LicensePlate" value="@Model.Appointment?.LicensePlate" />

                                        </div>
                                        <span asp-validation-for="Appointment.LicensePlate" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" for="CarModelId">مدل خودرو <span class="text-danger">*</span></label>
                                        <select class="select2 form-select" id="CarModelId" name="Appointment.CarModelId">
                                            <option value="">انتخاب کنید...</option>
                                            @if (Model.CarModels != null)
                                            {
                                                @foreach (var item in @Model.CarModels)
                                                {
                                                    <option  value="@item.Id"   
                                                             selected="@(Model.Appointment?.CarModelId == item.Id)">
                                                        @item.Name 
                                                        </option>
                                                    }
                                                }
                                        </select>
                                        <span asp-validation-for="Appointment.CarModelId" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" for="ProductionYear">سال ساخت</label>
                                        <input class="form-control" id="ProductionYear" name="Appointment.ProductionYear" value="@Model.Appointment?.ProductionYear" placeholder="1395" type="number" min="1350" max="@DateTime.Now.Year.ToString()" />
                                        <span asp-validation-for="Appointment.ProductionYear" class="text-danger"></span>
                                    </div>


                                    <div class="col-12">
                                        <label class="form-label" for="CarImages">بارگذاری تصاویر خودرو (حداکثر ۱۰ فایل)</label>
                                        <input type="file" name="CarImages" id="CarImages" multiple class="form-control" accept="image/*" />
                                    </div>

                                </div>

                                <div class="col-12 text-center mt-5">
                                    <button class="btn btn-primary btn-lg waves-effect waves-light" type="submit">
                                        <i class="ti ti-check me-sm-1"></i>
                                        <span class="align-middle d-sm-inline-block d-none">ثبت نوبت معاینه فنی</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>



    </section>

</div>

@section PageScripts {
    <script>
        $(document).ready(function () {
            const plateParts = ['#PlaquePart1', '#PlaquePart2', '#PlaquePart3', '#PlaquePart4'];

            function updateLicensePlate() {
                var fullPlate = plateParts.map(id => $(id).val()).join('');
                $('#LicensePlate').val(fullPlate);
            }

            $(plateParts.join(', ')).on('input', function () {
                updateLicensePlate();

                const $this = $(this);
                const currentId = '#' + $this.attr('id');
                const maxLength = parseInt($this.attr('maxlength'));

                if ($this.val().length === maxLength) {
                    const currentIndex = plateParts.indexOf(currentId);
                    if (currentIndex < plateParts.length - 1) {
                        $(plateParts[currentIndex + 1]).focus();
                    }
                }
            });


            $(plateParts.join(', ')).on('keydown', function (e) {
                const $this = $(this);
                const currentId = '#' + $this.attr('id');
                const currentIndex = plateParts.indexOf(currentId);


                if (e.keyCode === 39) {
                    if (currentIndex < plateParts.length - 1) {
                        e.preventDefault();
                        $(plateParts[currentIndex + 1]).focus();
                    }
                }

                else if (e.keyCode === 37 || (e.keyCode === 8 && $this.val().length === 0)) {
                    if (currentIndex > 0) {
                        e.preventDefault();
                        $(plateParts[currentIndex - 1]).focus();
                        if (e.keyCode === 8) {
                           const prevField = $(plateParts[currentIndex - 1])[0];
                           const prevLength = prevField.value.length;
                           if (prevField.setSelectionRange) {
                               prevField.setSelectionRange(prevLength, prevLength);
                           } else if (prevField.createTextRange) {
                               var range = prevField.createTextRange();
                               range.collapse(true);
                               range.moveEnd('character', prevLength);
                               range.moveStart('character', prevLength);
                               range.select();
                           }
                        }
                    }
                }
            });


            var initialFullPlate = $('#LicensePlate').val();
            if (initialFullPlate && initialFullPlate.length >= 8) {
                $('#PlaquePart1').val(initialFullPlate.substring(0, 2));
                $('#PlaquePart2').val(initialFullPlate.substring(2, 3));
                $('#PlaquePart3').val(initialFullPlate.substring(3, 6));
                $('#PlaquePart4').val(initialFullPlate.substring(6, 8));
            }

            updateLicensePlate();
        });
    </script>
}


@await Html.PartialAsync("Layouts/Sections/_Scripts" + ViewData["frontVar"])

<script src='~/js/@ViewData["main"]main.dist.js'></script>